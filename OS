#include <sys/types.h>
#include <dirent.h>
#include <sys/stat.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>


long num =0;

void travel(char *path){
	DIR *dirp;
	struct dirent *dentry;
	struct stat finfo;
	
	
	printf("visiting %s\n", path);
	chdir(path);
	
	dirp = opendir(".");
	if(dirp == NULL)
		return;
		
	while((dentry = readdir(dirp)) != NULL){
		if (stat(dentry->d_name, &finfo) == -1) continue;
		if (!S_ISDIR(finfo.st_mode)) 
			if(S_ISREG(finfo.st_mode)){
				num += finfo.st_size;
				continue;
			}
		if (strcmp(dentry->d_name, ".") == 0) continue;
		if (strcmp(dentry->d_name, "..") == 0) continue;
		
		travel(dentry->d_name);	
	}
	closedir(dirp);
	chdir("..");
	printf("leaving %s\n",path);
	return;
}

int main(void)
{
	travel(".");
	printf("The total size of regular files : %ld\n",num);
	return(0);
	
}
